<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Mirror Timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: 'Noto Sans KR', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
            cursor: none; /* 거울용 마우스 숨김 */
        }
        #clock { font-size: 2rem; margin-top: 30px; color: #888; }
        #display { font-size: 9rem; font-weight: 700; margin: auto 0; transition: color 0.2s; }
        .flashing { animation: flash 0.5s infinite; }
        @keyframes flash { 0% { color: #FF4B2B; } 50% { color: black; } 100% { color: #FF4B2B; } }
        .adjust-container { display: flex; gap: 15px; margin-bottom: 20px; }
        .adj-btn { background-color: transparent; color: #FFD700; border: 2px solid #FFD700; padding: 15px 25px; font-size: 1.5rem; border-radius: 10px; font-weight: bold; }
        .control-container { display: flex; gap: 20px; margin-bottom: 60px; }
        .ctrl-btn { padding: 20px 40px; font-size: 1.8rem; font-weight: 700; border: none; border-radius: 15px; color: white; min-width: 150px; }
        #start-btn { background-color: #00D166; }
        #up-btn { background-color: #1E90FF; }
        #reset-btn { background-color: #FF4B2B; }
        button:active { transform: scale(0.9); }
    </style>
</head>
<body>

    <div id="clock">00:00:00</div>
    <div id="display">00:00:00</div>

    <div class="adjust-container">
        <button class="adj-btn" onclick="addMinutes(1)">+1분</button>
        <button class="adj-btn" onclick="addMinutes(5)">+5분</button>
        <button class="adj-btn" onclick="addMinutes(10)">+10분</button>
        <button class="adj-btn" onclick="addMinutes(30)">+30분</button>
    </div>

    <div class="control-container">
        <button id="start-btn" class="ctrl-btn" onclick="toggleTimer()">카운트 다운</button>
        <button id="up-btn" class="ctrl-btn" onclick="startCountup()">카운트 업</button>
        <button id="reset-btn" class="ctrl-btn" onclick="resetTimer()">리셋</button>
    </div>

    <audio id="beep-sound" src="beep.wav" loop></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

        // 원정님 이미지의 설정값 적용
        const firebaseConfig = {
            apiKey: "AIzaSyCr3TFLtacU-MvXz2d2FB6SUAa_tlPKE70",
            authDomain: "status-ef996.firebaseapp.com",
            databaseURL: "https://status-ef996-default-rtdb.firebaseio.com",
            projectId: "status-ef996",
            appId: "1:675167661957:web:eb862fad09696074285eec"
        };
        initializeApp(firebaseConfig);

        // 변수 선언 (대문자 False -> 소문자 false로 수정)
        let secondsElapsed = 0;
        let running = false; 
        let mode = "CLOCK";
        let timerInterval = null;

        const displayEl = document.getElementById('display');
        const startBtn = document.getElementById('start-btn');
        const clockEl = document.getElementById('clock');
        const beepSound = document.getElementById('beep-sound');

        function updateClock() {
            const now = new Date();
            clockEl.textContent = now.toLocaleTimeString('ko-KR', { hour12: false });
        }
        setInterval(updateClock, 1000);
        updateClock();

        function formatTime(secs) {
            const h = Math.floor(secs / 3600).toString().padStart(2, '0');
            const m = Math.floor((secs % 3600) / 60).toString().padStart(2, '0');
            const s = (secs % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        // 전역 스코프로 함수 노출 (type="module" 대응)
        window.addMinutes = (mins) => {
            if (!running) {
                stopAlarm();
                mode = "COUNTDOWN";
                secondsElapsed += mins * 60;
                displayEl.textContent = formatTime(secondsElapsed);
                displayEl.style.color = "#FFD700";
            }
        };

        window.toggleTimer = () => {
            if (secondsElapsed > 0 || mode === "COUNTUP") {
                stopAlarm();
                running = !running;
                if (running) {
                    startBtn.textContent = "정지";
                    startBtn.style.backgroundColor = "#FFA500";
                    timerInterval = setInterval(tick, 1000);
                } else {
                    pauseTimer();
                }
            }
        };

        window.startCountup = () => {
            resetTimer();
            mode = "COUNTUP";
            running = true;
            startBtn.textContent = "정지";
            startBtn.style.backgroundColor = "#FFA500";
            timerInterval = setInterval(tick, 1000);
        };

        window.resetTimer = () => {
            clearInterval(timerInterval);
            stopAlarm();
            running = false;
            mode = "CLOCK";
            secondsElapsed = 0;
            displayEl.textContent = "00:00:00";
            displayEl.style.color = "white";
            startBtn.textContent = "카운트 다운";
            startBtn.style.backgroundColor = "#00D166";
        };

        function tick() {
            if (mode === "COUNTUP") {
                secondsElapsed++;
                displayEl.style.color = "#00D166";
            } else if (mode === "COUNTDOWN") {
                if (secondsElapsed > 0) {
                    secondsElapsed--;
                } else {
                    triggerAlarm();
                }
            }
            displayEl.textContent = formatTime(secondsElapsed);
        }

        function triggerAlarm() {
            clearInterval(timerInterval);
            running = false;
            displayEl.textContent = "TIME UP!";
            displayEl.classList.add('flashing');
            beepSound.play().catch(e => console.log("소리 재생 실패:", e));
            startBtn.textContent = "카운트 다운";
            startBtn.style.backgroundColor = "#00D166";
        }

        function stopAlarm() {
            displayEl.classList.remove('flashing');
            beepSound.pause();
            beepSound.currentTime = 0;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            startBtn.textContent = "재개";
            startBtn.style.backgroundColor = "#00D166";
        }
    </script>
</body>
</html>